## Домашнее задание 1

### Цели

- Собрать схему CLOS

- Распределить адресное пространство

### Схема сети
![Network scheme](Clos.png)

|Device|Interface|IP|Description|
|-|-|-|-|
|Spine-1|Loopback0|10.0.0.0/32|Underlay loopback|
|       |Loopback1|10.0.1.0/32||
|       |Ethernet1|10.0.128.0/31|P-t-p to Leaf-1|
|       |Ethernet2|10.0.128.2/31|P-t-p to Leaf-2|
|       |Ethernet3|10.0.128.4/31|P-t-p to Leaf-3|
|Spine-2|Loopback0|10.0.0.1/32|Underlay loopback|
|       |Loopback1|10.0.1.1/32||
|       |Ethernet1|10.0.132.0/31|P-t-p to Leaf-1|
|       |Ethernet2|10.0.132.2/31|P-t-p to Leaf-2|
|       |Ethernet3|10.0.132.4/31|P-t-p to Leaf-3|
|Leaf-1 |Loopback0|10.0.4.0/32|Underlay loopback|
|       |Loopback1|10.0.6.0/32||
|       |Ethernet1||Client-1 switchport|
|       |Ethernet7|10.0.128.1/31|P-t-p to Spine-1|
|       |Ethernet8|10.0.132.1/31|P-t-p to Spine-2|
|Leaf-2 |Loopback0|10.0.4.1/32|Underlay loopback|
|       |Loopback1|10.0.6.1/32||
|       |Ethernet1||Client-2 switchport|
|       |Ethernet7|10.0.128.3/31|P-t-p to Spine-1|
|       |Ethernet8|10.0.132.3/31|P-t-p to Spine-2|
|Leaf-3 |Loopback0|10.0.4.2/32|Underlay loopback|
|       |Loopback1|10.0.6.2/32||
|       |Ethernet1||Client-3 switchport|
|       |Ethernet2||Client-4 switchport|
|       |Ethernet7|10.0.128.5/31|P-t-p to Spine-1|
|       |Ethernet8|10.0.132.5/31|P-t-p to Spine-2|

### Распределение адресного пространство

Перед планированием распределения адресного пространства для underlay-сети ЦОД, определим исходные условия и ограничения:

- в каждом ЦОД используется двухуровневая архитерктура Spine/Leaf, без уровня Superspine

- для расчета необходимых размеров адресных блоков, в качестве реперной точки, будем ориентироваться на применение фиксированных коммутаторов семейства Cisco Nexus 9300 с максимальной, на данный момент, портовой ёмкостью (при использовании оборудования с меньшим числов портов, расчеты останутся актуальными):

  - Cisco Nexus N9364E-SG2-Q, 64 порта 800G - Spine 

  - Cisco Nexus 9364C-H1, 64 порта 100G - Leaf, 

- **максимальное количество Spine в ЦОД составляет 32**, исходя из задействования половины (64 / 2 = 32) портов Leaf, каждый из которых соединён с отдельным Spine, что даёт для Leaf наилучшее отношение переподписки 1:1

- **максимальное число Leaf в ЦОД составляет 512**, исходя из занятия всех портов Spine, работающих в режиме 8x100G breakout (64 x 8 = 512)

- на каждом Spine и Leaf необходимы два loopback-интерфейса с адресами /32, Loopback0 для underlay-сети, Loopback1 для остальных целей

- для p-t-p соединения Leaf-Spine используются блоки /31 (для одного ЦОД, максимальное число соединений составляет 32 x 512 = 16 384, а IP-адресов 16 384 x 2 = 32 768)

Для размещения перечисленных адресов, потребуются блоки:

- **/27** - Spine, Loopback0
- **/27** - Spine, Loopback1
- **/23** - Leaf, Loopback0
- **/23** - Leaf, Loopback1
- **/17** - соединения Leaf - Spine

При суммировании, минимально достаточным является блок **/16**.

Внутренее адресное пространство IPv4 для отдельных ЦОД-ов выделяется блоками **10.[N-1].0.0/16**, из приватного блока **10.0.0.0/8** (*RFC1918*), что допускает адресацию **до 256 ЦОД**:

- **10.0.0.0/16** - ЦОД 1
- **10.1.0.0/16** - ЦОД 2
- **...**
- **10.255.0.0/16** - ЦОД 256

В блоке **/16** каждого ЦОД, выделяются субблоки:

- **10.[N-1].0.0/27** - Spine, Loopback0
- **10.[N-1].1.0/27** - Spine, Loopback1
- **10.[N-1].4.0/23** - Leaf, Loopback0
- **10.[N-1].6.0/23** - Leaf, Loopback1
- **10.[N-1].128.0/17** - соединения Leaf - Spine

*Два блока **/27** для loopback-интерфейсов Spine возможно уместить в **/26**, но, выравнивание на границу **/24** даёт большую наглядность, за счет равенства младшего октета для адресов одного устройства.*

Интерфейсам коммутаторов назначаются адреса:

- **10.[N-1].0.[S-1]/32** - Spine-S, Loopback0
- **10.[N-1].1.[S-1]/32** - Spine-S, Loopback1
- **10.[N-1].[4 + (L-1) div 256].[(L-1) mod 256]/32** - Leaf-L, Loopback0
- **10.[N-1].[6 + (L-1) div 256].[(L-1) mod 256]/32** - Leaf-L, Loopback1
- **10.[N-1].[128 + 4 * (S-1) + (L-1) div 128].[2 * (L-1) mod 128]/31** - Spine-S соединение с Leaf-L
- **10.[N-1].[128 + 4 * (S-1) + (L-1) div 128].[2 * (L-1) mod 128 + 1]/31** - Leaf-L соединение с Spine-S

где:

- **N** - номер ЦОД в диапазоне [1-256]
- **S** - номер Spine в диапазоне [1-32]
- **L** - номер Leaf  в диапазоне [1-512]

Помимо блоков, используемых для адресации underlay-сети, в адресном пространстве **/16** каждого ЦОД-а, остаются свободные адреса:

- **10.[N-1].2.0/23**
- **10.[N-1].8.0/21**
- **10.[N-1].16.0/20**
- **10.[N-1].32.0/19**
- **10.[N-1].64.0/18**

которые могут быть задействованы для адресации других, локальных в пределах ЦОД, ресурсов.

*В файле [IP calc.xlsx](https://github.com/IronWhale11/Otus-DC-networks-design/blob/main/labs/lab01/IP%20calc.xlsx) находится калькулятор для заполнения массивов адресов, согласно предложенной схемы.*
