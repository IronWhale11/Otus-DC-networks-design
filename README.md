## Домашнее задание 1

### Цели

- Собрать схему CLOS

- Распределить адресное пространство

### Распределение адресного пространство

Перед планированием адресного пространства underlay-сети ЦОД, определим исходные условия и ограничения:

- в каждом ЦОД используется двухуровневая архитерктура Spine/Leaf, без уровня Superspine

- для расчета необходимых размеров адресных блоков, в качестве реперной точки, будем ориентироваться на применение фиксированных коммутаторов семейства Cisco Nexus 9300 с максимальной, на данный момент, портовой ёмкостью (при использовании моделей с меньшим числов портов, расчеты останутся актуальными):

  - Cisco Nexus N9364E-SG2-Q, 64 порта 800G - Spine 

  - Cisco Nexus 9364C-H1, 64 порта 100G - Leaf, 

- **максимальное количество Spine в ЦОД составляет 32**, исходя из задействования половины (64 / 2 = 32) портов Leaf, каждый из которых соединён с отдельным Spine, что даёт для Leaf наилучшее отношение переподписки 1:1

- **максимальное число Leaf в ЦОД составляет 512**, исходя из занятия всех портов Spine, работающих в режиме 8x100G breakout (64 x 8 = 512)

- на каждом Spine и Leaf необходимы два loopback-интерфейса с адресами /32

- для p-t-p соединения Leaf-Spine используются блоки /31 (для одного ЦОД, максимальное число соединений составляет 32 x 512 = 16 384, а IP-адресов 16 384 x 2 = 32 768)

Таким образом, для размещения перечисленных адресов, потребуются блоки:

- **/27** - Spine, Loopback0
- **/27** - Spine, Loopback1
- **/23** - Leaf, Loopback0
- **/23** - Leaf, Loopback1
- **/17** - соединения Leaf - Spine

При суммировании, минимально достаточным является блок **/16**.

Внутренее адресное пространство IPv4 для отдельных ЦОД-ов выделяется блоками **10.[N-1].0.0/16**, из приватного блока **10.0.0.0/8** (*RFC1918*),
что допускает адресацию **до 256 ЦОД**:

- **10.0.0.0/16** - ЦОД 1
- **10.1.0.0/16** - ЦОД 2
- **...**
- **10.255.0.0/16** - ЦОД 256

В блоке **/16** каждого ЦОД, выделяются субблоки:

- **10.[N-1].0.0/27** - Spine, Loopback0
- **10.[N-1].1.0/27** - Spine, Loopback1
- **10.[N-1].4.0/23** - Leaf, Loopback0
- **10.[N-1].6.0/23** - Leaf, Loopback1
- **10.[N-1].128.0/23** - соединения Leaf - Spine

*Два блока **/27** для loopback-интерфейсов Spine возможно разместить в одном блоке **/26**, но, выравнивание на границу **/24**,
за счет чего, значения младшего октета для адресов одного устройства совпадают, более наглядно.*

Интерфейсам коммутаторов назначаются адреса:

- **10.[N-1].0.[S-1]/32** - Spine-S, Loopback0
- **10.[N-1].1.[S-1]/32** - Spine-S, Loopback1
- **10.[N-1].[4 + ((L-1) div 256)].[(L-1) mod 256]/32** - Leaf-L, Loopback0
- **10.[N-1].[6 + ((L-1) div 256)].[(L-1) mod 256]/32** - Leaf-L, Loopback1
- **10.[N-1].[128 + (4 * (S div 4) + (S mod 4) - 1)].[2 * ((L-1) mod 128)]/31** - Spine-S соединение с Leaf-L
- **10.[N-1].[128 + (4 * (S div 4) + (S mod 4) - 1)].[2 * ((L-1) mod 128) + 1]/31** - Leaf-L соединение с Spine-S

где:

- **N** - номер ЦОД в диапазоне [1-256]
- **S** - номер Spine в диапазоне [1-32]
- **L** - номер Leaf  в диапазоне [1-512]

Примеры адресации:

|ЦОД|Spine|Leaf|Spine, Loopback0|Spine, Loopback1|Leaf, Loopback0|Leaf, Loopback1|P-t-P, Spine   |P-t-P, Leaf    |
|-: |-:   |-:  |-:              |-:              |-:             |-:             |-:             |-:             |
|1  |	 1|	  2|	 10.0.0.0/32|	 10.0.1.0/32 |	  10.0.4.1/32|    10.0.6.1/32|  10.0.128.2/31|	10.0.128.3/31|
|2  |	16|	 28|    10.1.0.15/32|	10.1.1.15/32 |	 10.1.4.27/32|	 10.1.6.27/32| 10.1.143.54/31| 10.1.143.55/31|
|10 |	32|	512|	10.9.0.31/32|	10.9.1.31/32 |	10.9.5.255/32|	10.9.7.255/32|10.9.159.254/31|10.9.159.255/31|

*В файле "IP calc.xlsx" находится калькулятор для быстрого заполнения массивов адресов.*

Помимо блоков, используемых для адресации underlay-сети, в адресном пространстве **/16** каждого ЦОД-а, остаются свободные адреса:

- **10.[N-1].2.0/23**
- **10.[N-1].8.0/21**
- **10.[N-1].16.0/20**
- **10.[N-1].32.0/19**
- **10.[N-1].64.0/18**
